{"version":3,"sources":["components/training/quota/detail.js"],"names":["Allocation","props","closeModalAllocation","e","setState","modalAllocation","amount","licensesId","mode","handleChange","target","name","value","filter","preventDefault","filterHistory","state","userId","companyId","data","dataLicenses","licensesTypeId","id","note","isSaving","this","toast","warning","form","company_id","licenses_type_id","licenses_allocation_id","type","created_by","API","post","API_SERVER","then","res","error","result","success","getAllocation","getHistory","get","USER_ME","Storage","email","status","localStorage","getItem","user_id","match","params","getUserData","String","prototype","capitalize","charAt","toUpperCase","slice","columns","cell","row","moment","tz","created_at","guess","format","selector","sortable","transaction_type","columnsLicenses","grow","lockEdit","onClick","className","x","JSON","stringify","Object","values","RegExp","style","marginLeft","padding","src","alt","width","history","goBack","bind","color","placeholder","onChange","highlightOnHover","defaultSortField","pagination","fixedHeader","show","onHide","centered","Header","closeButton","Title","Body","for","size","min","Footer","save","disabled","Component"],"mappings":"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","file":"static/js/138.cc16a863.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport DataTable from 'react-data-table-component';\nimport '@trendmicro/react-dropdown/dist/react-dropdown.css';\nimport API, { API_SERVER, USER_ME } from '../../../repository/api';\nimport { toast } from \"react-toastify\";\nimport { Modal } from 'react-bootstrap';\nimport Storage from '../../../repository/storage';\nimport moment from 'moment-timezone';\n\nclass Allocation extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n        userId: '',\n        companyId: '',\n        data : [],\n        dataLicenses : [],\n        filter:'',\n        filterHistory:'',\n        licensesId: '',\n        licensesTypeId: '',\n        modalAllocation: false,\n        amount: '',\n        mode: '',\n        id: '',\n        note:'',\n        isSaving: false\n    };\n  }\n  \n  closeModalAllocation = e => {\n    this.setState({ modalAllocation: false, amount: '', licensesId: '', mode: '' })\n  }\n\n  handleChange = e => {\n    let {name, value} = e.target;\n    if (name === 'amount'){\n      if (value < 0){\n        this.setState({[name]: 0})\n      }\n      else{\n        this.setState({[name]: value})\n      }\n    }\n    else{\n      this.setState({[name]: value})\n    }\n  }\n\n  \n  save(){\n    this.setState({isSaving: true});\n    if (this.state.amount === '' || this.state.amount === '0'){\n        toast.warning('Please fill amount')\n        this.setState({isSaving: false});\n    }\n    else{\n          let form = {\n              company_id: this.state.id,\n              licenses_type_id: this.state.licensesTypeId,\n              licenses_allocation_id: this.state.licensesId,\n              amount : this.state.amount,\n              type : this.state.mode,\n              note : this.state.note,\n              created_by : this.state.userId,\n          }\n          API.post(`${API_SERVER}v2/training/quota/company/transaction`, form).then(res => {\n              if (res.data.error){\n                  toast.error(res.data.result)\n                  this.setState({isSaving: false});\n              }\n              else{\n                  toast.success(`Success for licenses allocation ${this.state.mode}`)\n                  this.closeModalAllocation();\n                  this.getAllocation();\n                  this.getHistory();\n                  this.setState({isSaving: false});\n              }\n          })\n    }\n  }\n\n  getUserData(){\n    API.get(`${USER_ME}${Storage.get('user').data.email}`).then(res => {\n        if (res.status === 200) {\n            this.setState({ companyId: localStorage.getItem('companyID') ? localStorage.getItem('companyID') : res.data.result.company_id, userId: res.data.result.user_id });\n            this.getAllocation();\n            this.getHistory();\n        }\n    })\n  }\n\n  filter = (e) => {\n    e.preventDefault();\n    this.setState({ filter: e.target.value });\n  }\n\n  filterHistory = (e) => {\n    e.preventDefault();\n    this.setState({ filterHistory: e.target.value });\n  }\n\n  getAllocation(){\n    API.get(`${API_SERVER}v2/training/quota/company/${this.state.id}`).then(res => {\n        if (res.data.error){\n            toast.error(`Error read licenses allocation`)\n        }\n        else{\n            this.setState({dataLicenses: res.data.result})\n        }\n    })\n  }\n\n  getHistory(){\n    API.get(`${API_SERVER}v2/training/quota/company/history/${this.state.id}`).then(res => {\n        if (res.data.error){\n            toast.error(`Error read licenses allocation`)\n        }\n        else{\n            this.setState({data: res.data.result})\n        }\n    })\n  }\n\n  componentDidMount(){\n    if (this.props.id){\n        this.setState({id: this.props.id})\n    }\n    else if (this.props.match.params.id){\n        this.setState({id: this.props.match.params.id})\n    }\n      this.getUserData();\n  }\n\n\n  render() {\n    String.prototype.capitalize = function() {\n        return this.charAt(0).toUpperCase() + this.slice(1);\n    }\n    const columns = [\n      {\n        cell: row => moment.tz(row.created_at, moment.tz.guess(true)).format(\"DD-MM-YYYY HH:mm\"),\n        name: 'Time',\n        selector: 'created_at',\n        sortable: true\n      },\n      {\n        name: 'Amount',\n        selector: 'amount',\n        sortable: true\n      },\n      {\n        cell: row => row.transaction_type.capitalize(),\n        name: 'Transaction Type',\n        selector: 'transaction_type',\n        sortable: true\n      },\n      {\n        name: 'Licenses Type',\n        selector: 'type',\n        sortable: true\n      },\n      {\n        name: 'Note',\n        selector: 'note',\n        sortable: true\n      },\n      {\n        name: 'Created By',\n        selector: 'created_by',\n        sortable: true\n      },\n    ];\n    const columnsCompany = [\n      {\n        name: 'Time',\n        selector: 'created_at',\n        sortable: true\n      },\n      {\n        name: 'Amount',\n        selector: 'amount',\n        sortable: true\n      },\n      {\n        cell: row => row.transaction_type.capitalize(),\n        name: 'Transaction Type',\n        selector: 'transaction_type',\n        sortable: true\n      },\n      {\n        name: 'Licenses Type',\n        selector: 'type',\n        sortable: true\n      },\n      {\n        name: 'Training Company',\n        selector: 'training_company',\n        sortable: true\n      },\n      {\n        name: 'Note',\n        selector: 'note',\n        sortable: true\n      },\n      {\n        name: 'Created By',\n        selector: 'created_by',\n        sortable: true\n      },\n    ];\n    const columnsLicenses = [\n      {\n        name: 'Type',\n        selector: 'type',\n        sortable: true,\n        grow: 2\n      },\n      {\n        name: 'Notes',\n        selector: 'notes',\n        sortable: true,\n        grow: 2\n      },\n      {\n        name: 'Remaining Allocation',\n        selector: 'remaining_allocation',\n        sortable: true\n      },\n      {\n        name: 'Action',\n        cell: row =>\n        <div>\n            {!this.props.lockEdit && <button onClick={()=> this.setState({modalAllocation: true, licensesId: row.id, licensesTypeId: row.licenses_type_id, mode: 'addition'})} className=\"button-table-plus\">+</button>}\n            {!this.props.lockEdit && <button onClick={()=> this.setState({modalAllocation: true, licensesId: row.id, licensesTypeId: row.licenses_type_id, mode: 'reduction'})} className=\"button-table-min\">-</button>}\n        </div>\n      }\n    ];\n    let {data, dataLicenses, filter, filterHistory} = this.state;\n    if (filter != \"\") {\n        dataLicenses = dataLicenses.filter(x =>\n        JSON.stringify(\n          Object.values(x)\n        ).match(new RegExp(filter, \"gmi\"))\n      )\n    }\n    if (filterHistory != \"\") {\n      data = data.filter(x =>\n        JSON.stringify(\n          Object.values(x)\n        ).match(new RegExp(filterHistory, \"gmi\"))\n      )\n    }\n    return(\n        <div className=\"pcoded-main-container\" style={this.props.id ? {marginLeft: 0} : null}>\n            <div className=\"pcoded-wrapper\">\n                <div className=\"pcoded-content\" style={this.props.id ? {padding: 0} : null}>\n                    <div className=\"pcoded-inner-content\">\n                        <div className=\"main-body\">\n                            <div className=\"page-wrapper\">\n                                {\n                                    !this.props.id &&\n                                    <div className=\"floating-back\">\n                                        <img\n                                        src={`newasset/back-button.svg`}\n                                        alt=\"\"\n                                        width={90}\n                                        onClick={this.props.history.goBack.bind(this)}\n                                        ></img>\n                                    </div>\n                                }\n                                <div className=\"row\">\n                                    <div className=\"col-xl-12\">\n        <div>\n            <div className=\"card p-20 main-tab-container\">\n                <div className=\"row\">\n                    <div className=\"col-sm-12 m-b-20\">\n                        <strong className=\"f-w-bold f-18\" style={{color:'#000'}}>Licenses</strong>\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search\"\n                            onChange={this.filter}\n                            className=\"form-control float-right col-sm-3\"/>\n                            <DataTable\n                            columns={columnsLicenses}\n                            data={dataLicenses}\n                            highlightOnHover\n                            defaultSortField=\"type\"\n                            pagination\n                            fixedHeader\n                            />\n                    </div>\n                </div>\n            </div>\n            <div className=\"card p-20 main-tab-container\">\n                <div className=\"row\">\n                    <div className=\"col-sm-12 m-b-20\">\n                        <strong className=\"f-w-bold f-18\" style={{color:'#000'}}>License Allocation History</strong>\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search\"\n                            onChange={this.filterHistory}\n                            className=\"form-control float-right col-sm-3\"/>\n                            <DataTable\n                            columns={this.props.lockEdit ? columnsCompany : columns}\n                            data={data}\n                            highlightOnHover\n                            pagination\n                            fixedHeader\n                            />\n                    </div>\n                </div>\n            </div>\n          <Modal show={this.state.modalAllocation} onHide={this.closeModalAllocation} centered>\n            <Modal.Header closeButton>\n              <Modal.Title className=\"text-c-purple3 f-w-bold\" style={{ color: '#00478C' }}>\n                {this.state.mode === 'addition' ? 'Add' : 'Reduce'} Licenses Allocation\n              </Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <div className=\"form-field-top-label\">\n                    <label for=\"amount\">Amount of {this.state.mode === 'addition' ? 'Addition' : 'Reduction'}<required>*</required></label>\n                    <input type=\"number\" name=\"amount\" size=\"50\" id=\"amount\" min=\"0\" placeholder=\"0\" value={this.state.amount} onChange={this.handleChange}/>\n                </div>\n                <div className=\"form-field-top-label\" style={{width:'100%'}}>\n                    <label for=\"note\">Note</label>\n                    <textarea name=\"note\" onChange={this.handleChange} value={this.state.note} style={{width:'80%'}}></textarea>\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n              <button className=\"btn btm-icademy-primary btn-icademy-grey\" onClick={this.closeModalAllocation.bind(this)}>\n                Cancel\n              </button>\n              <button className=\"btn btn-icademy-primary\" onClick={this.save.bind(this)} disabled={this.state.isSaving}>\n                <i className={`fa fa-${this.state.mode === 'addition' ? 'plus' : 'minus'}`}></i> {this.state.mode === 'addition' ? 'Add' : 'Reduce'}\n              </button>\n            </Modal.Footer>\n          </Modal>\n        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    )\n  }\n}\n\nexport default Allocation;\n"],"sourceRoot":""}