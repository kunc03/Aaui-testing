{"version":3,"sources":["components/training/quota/detail.js"],"names":["Allocation","Component","constructor","props","super","closeModalAllocation","e","this","setState","modalAllocation","amount","licensesId","mode","handleChange","name","value","target","filter","preventDefault","filterHistory","state","userId","companyId","data","dataLicenses","licensesTypeId","id","note","isSaving","save","toast","warning","form","company_id","licenses_type_id","licenses_allocation_id","type","created_by","API","post","API_SERVER","then","res","error","result","success","getAllocation","getHistory","getUserData","get","USER_ME","Storage","email","status","localStorage","getItem","user_id","componentDidMount","match","params","render","String","prototype","capitalize","charAt","toUpperCase","slice","columns","cell","row","moment","tz","created_at","guess","format","selector","sortable","transaction_type","columnsLicenses","grow","lockEdit","onClick","className","x","JSON","stringify","Object","values","RegExp","style","marginLeft","padding","src","alt","width","history","goBack","bind","color","placeholder","onChange","highlightOnHover","defaultSortField","pagination","fixedHeader","show","onHide","centered","Header","closeButton","Title","Body","for","size","min","Footer","disabled"],"mappings":"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","file":"static/js/139.f5dd4a41.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport DataTable from 'react-data-table-component';\nimport '@trendmicro/react-dropdown/dist/react-dropdown.css';\nimport API, { API_SERVER, USER_ME } from '../../../repository/api';\nimport { toast } from \"react-toastify\";\nimport { Modal } from 'react-bootstrap';\nimport Storage from '../../../repository/storage';\nimport moment from 'moment-timezone';\n\nclass Allocation extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n        userId: '',\n        companyId: '',\n        data : [],\n        dataLicenses : [],\n        filter:'',\n        filterHistory:'',\n        licensesId: '',\n        licensesTypeId: '',\n        modalAllocation: false,\n        amount: '',\n        mode: '',\n        id: '',\n        note:'',\n        isSaving: false\n    };\n  }\n  \n  closeModalAllocation = e => {\n    this.setState({ modalAllocation: false, amount: '', licensesId: '', mode: '' })\n  }\n\n  handleChange = e => {\n    let {name, value} = e.target;\n    if (name === 'amount'){\n      if (value < 0){\n        this.setState({[name]: 0})\n      }\n      else{\n        this.setState({[name]: value})\n      }\n    }\n    else{\n      this.setState({[name]: value})\n    }\n  }\n\n  \n  save(){\n    this.setState({isSaving: true});\n    if (this.state.amount === '' || this.state.amount === '0'){\n        toast.warning('Please fill amount')\n        this.setState({isSaving: false});\n    }\n    else{\n          let form = {\n              company_id: this.state.id,\n              licenses_type_id: this.state.licensesTypeId,\n              licenses_allocation_id: this.state.licensesId,\n              amount : this.state.amount,\n              type : this.state.mode,\n              note : this.state.note,\n              created_by : this.state.userId,\n          }\n          API.post(`${API_SERVER}v2/training/quota/company/transaction`, form).then(res => {\n              if (res.data.error){\n                  toast.error(res.data.result)\n                  this.setState({isSaving: false});\n              }\n              else{\n                  toast.success(`Success for licenses allocation ${this.state.mode}`)\n                  this.closeModalAllocation();\n                  this.getAllocation();\n                  this.getHistory();\n                  this.setState({isSaving: false});\n              }\n          })\n    }\n  }\n\n  getUserData(){\n    API.get(`${USER_ME}${Storage.get('user').data.email}`).then(res => {\n        if (res.status === 200) {\n            this.setState({ companyId: localStorage.getItem('companyID') ? localStorage.getItem('companyID') : res.data.result.company_id, userId: res.data.result.user_id });\n            this.getAllocation();\n            this.getHistory();\n        }\n    })\n  }\n\n  filter = (e) => {\n    e.preventDefault();\n    this.setState({ filter: e.target.value });\n  }\n\n  filterHistory = (e) => {\n    e.preventDefault();\n    this.setState({ filterHistory: e.target.value });\n  }\n\n  getAllocation(){\n    API.get(`${API_SERVER}v2/training/quota/company/${this.state.id}`).then(res => {\n        if (res.data.error){\n            toast.error(`Error read licenses allocation`)\n        }\n        else{\n            this.setState({dataLicenses: res.data.result})\n        }\n    })\n  }\n\n  getHistory(){\n    API.get(`${API_SERVER}v2/training/quota/company/history/${this.state.id}`).then(res => {\n        if (res.data.error){\n            toast.error(`Error read licenses allocation`)\n        }\n        else{\n            this.setState({data: res.data.result})\n        }\n    })\n  }\n\n  componentDidMount(){\n    if (this.props.id){\n        this.setState({id: this.props.id})\n    }\n    else if (this.props.match.params.id){\n        this.setState({id: this.props.match.params.id})\n    }\n      this.getUserData();\n  }\n\n\n  render() {\n    String.prototype.capitalize = function() {\n        return this.charAt(0).toUpperCase() + this.slice(1);\n    }\n    const columns = [\n      {\n        cell: row => moment.tz(row.created_at, moment.tz.guess(true)).format(\"DD-MM-YYYY HH:mm\"),\n        name: 'Time',\n        selector: 'created_at',\n        sortable: true\n      },\n      {\n        name: 'Amount',\n        selector: 'amount',\n        sortable: true\n      },\n      {\n        cell: row => row.transaction_type.capitalize(),\n        name: 'Transaction Type',\n        selector: 'transaction_type',\n        sortable: true\n      },\n      {\n        name: 'Licenses Type',\n        selector: 'type',\n        sortable: true\n      },\n      {\n        name: 'Note',\n        selector: 'note',\n        sortable: true\n      },\n      {\n        name: 'Created By',\n        selector: 'created_by',\n        sortable: true\n      },\n    ];\n    const columnsCompany = [\n      {\n        name: 'Time',\n        selector: 'created_at',\n        sortable: true\n      },\n      {\n        name: 'Amount',\n        selector: 'amount',\n        sortable: true\n      },\n      {\n        cell: row => row.transaction_type.capitalize(),\n        name: 'Transaction Type',\n        selector: 'transaction_type',\n        sortable: true\n      },\n      {\n        name: 'Licenses Type',\n        selector: 'type',\n        sortable: true\n      },\n      {\n        name: 'Training Company',\n        selector: 'training_company',\n        sortable: true\n      },\n      {\n        name: 'Note',\n        selector: 'note',\n        sortable: true\n      },\n      {\n        name: 'Created By',\n        selector: 'created_by',\n        sortable: true\n      },\n    ];\n    const columnsLicenses = [\n      {\n        name: 'Type',\n        selector: 'type',\n        sortable: true,\n        grow: 2\n      },\n      {\n        name: 'Notes',\n        selector: 'notes',\n        sortable: true,\n        grow: 2\n      },\n      {\n        name: 'Remaining Allocation',\n        selector: 'remaining_allocation',\n        sortable: true\n      },\n      {\n        name: 'Action',\n        cell: row =>\n        <div>\n            {!this.props.lockEdit && <button onClick={()=> this.setState({modalAllocation: true, licensesId: row.id, licensesTypeId: row.licenses_type_id, mode: 'addition'})} className=\"button-table-plus\">+</button>}\n            {!this.props.lockEdit && <button onClick={()=> this.setState({modalAllocation: true, licensesId: row.id, licensesTypeId: row.licenses_type_id, mode: 'reduction'})} className=\"button-table-min\">-</button>}\n        </div>\n      }\n    ];\n    let {data, dataLicenses, filter, filterHistory} = this.state;\n    if (filter != \"\") {\n        dataLicenses = dataLicenses.filter(x =>\n        JSON.stringify(\n          Object.values(x)\n        ).match(new RegExp(filter, \"gmi\"))\n      )\n    }\n    if (filterHistory != \"\") {\n      data = data.filter(x =>\n        JSON.stringify(\n          Object.values(x)\n        ).match(new RegExp(filterHistory, \"gmi\"))\n      )\n    }\n    return(\n        <div className=\"pcoded-main-container\" style={this.props.id ? {marginLeft: 0} : null}>\n            <div className=\"pcoded-wrapper\">\n                <div className=\"pcoded-content\" style={this.props.id ? {padding: 0} : null}>\n                    <div className=\"pcoded-inner-content\">\n                        <div className=\"main-body\">\n                            <div className=\"page-wrapper\">\n                                {\n                                    !this.props.id &&\n                                    <div className=\"floating-back\">\n                                        <img\n                                        src={`newasset/back-button.svg`}\n                                        alt=\"\"\n                                        width={90}\n                                        onClick={this.props.history.goBack.bind(this)}\n                                        ></img>\n                                    </div>\n                                }\n                                <div className=\"row\">\n                                    <div className=\"col-xl-12\">\n        <div>\n            <div className=\"card p-20 main-tab-container\">\n                <div className=\"row\">\n                    <div className=\"col-sm-12 m-b-20\">\n                        <strong className=\"f-w-bold f-18\" style={{color:'#000'}}>Licenses</strong>\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search\"\n                            onChange={this.filter}\n                            className=\"form-control float-right col-sm-3\"/>\n                            <DataTable\n                            columns={columnsLicenses}\n                            data={dataLicenses}\n                            highlightOnHover\n                            defaultSortField=\"type\"\n                            pagination\n                            fixedHeader\n                            />\n                    </div>\n                </div>\n            </div>\n            <div className=\"card p-20 main-tab-container\">\n                <div className=\"row\">\n                    <div className=\"col-sm-12 m-b-20\">\n                        <strong className=\"f-w-bold f-18\" style={{color:'#000'}}>License Allocation History</strong>\n                        <input\n                            type=\"text\"\n                            placeholder=\"Search\"\n                            onChange={this.filterHistory}\n                            className=\"form-control float-right col-sm-3\"/>\n                            <DataTable\n                            columns={this.props.lockEdit ? columnsCompany : columns}\n                            data={data}\n                            highlightOnHover\n                            pagination\n                            fixedHeader\n                            />\n                    </div>\n                </div>\n            </div>\n          <Modal show={this.state.modalAllocation} onHide={this.closeModalAllocation} centered>\n            <Modal.Header closeButton>\n              <Modal.Title className=\"text-c-purple3 f-w-bold\" style={{ color: '#00478C' }}>\n                {this.state.mode === 'addition' ? 'Add' : 'Reduce'} Licenses Allocation\n              </Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n                <div className=\"form-field-top-label\">\n                    <label for=\"amount\">Amount of {this.state.mode === 'addition' ? 'Addition' : 'Reduction'}<required>*</required></label>\n                    <input type=\"number\" name=\"amount\" size=\"50\" id=\"amount\" min=\"0\" placeholder=\"0\" value={this.state.amount} onChange={this.handleChange}/>\n                </div>\n                <div className=\"form-field-top-label\" style={{width:'100%'}}>\n                    <label for=\"note\">Note</label>\n                    <textarea name=\"note\" onChange={this.handleChange} value={this.state.note} style={{width:'80%'}}></textarea>\n                </div>\n            </Modal.Body>\n            <Modal.Footer>\n              <button className=\"btn btm-icademy-primary btn-icademy-grey\" onClick={this.closeModalAllocation.bind(this)}>\n                Cancel\n              </button>\n              <button className=\"btn btn-icademy-primary\" onClick={this.save.bind(this)} disabled={this.state.isSaving}>\n                <i className={`fa fa-${this.state.mode === 'addition' ? 'plus' : 'minus'}`}></i> {this.state.mode === 'addition' ? 'Add' : 'Reduce'}\n              </button>\n            </Modal.Footer>\n          </Modal>\n        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    )\n  }\n}\n\nexport default Allocation;\n"],"sourceRoot":""}