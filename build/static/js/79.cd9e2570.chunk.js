(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[79],{1363:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(18),s=n(3),r=n(2),c=n(305);class l extends i.Component{constructor(e){super(e),this.closeModalDelete=e=>{this.setState({modalDelete:!1,deleteId:""})},this.save=e=>{if(this.setState({isSaving:!0}),e.preventDefault(),this.state.title.length&&this.state.content.length)if(this.state.id){let e={title:this.state.title,content:this.state.content};s.l.put("".concat(s.a,"v2/news/").concat(this.state.id),e).then(e=>{if(e.data.error)o.b.error("Error edit news"),this.setState({isSaving:!1});else if(this.state.image){let e=new FormData;e.append("image",this.state.image),s.l.put("".concat(s.a,"v2/news/image/").concat(this.state.id),e).then(e=>{e.data.error?(o.b.warning("News edited but fail to upload image"),this.setState({edited:!1,isSaving:!1})):(o.b.success("News edited"),this.setState({edited:!1,isSaving:!1}),this.props.history.push("/news"))})}else o.b.success("News edited"),this.setState({edited:!1,isSaving:!1}),this.props.history.push("/news")})}else{let e={company_id:this.state.companyId,title:this.state.title,content:this.state.content,created_by:this.state.userId};s.l.post("".concat(s.a,"v2/news"),e).then(e=>{if(e.data.error)o.b.error("Error saving news"),this.setState({isSaving:!1});else if(this.state.image){let t=new FormData;t.append("image",this.state.image),s.l.put("".concat(s.a,"v2/news/image/").concat(e.data.result.insertId),t).then(e=>{e.data.error?(o.b.warning("News saved but fail to upload image"),this.setState({edited:!1,isSaving:!1})):(o.b.success("News saved"),this.setState({edited:!1,isSaving:!1}),this.props.history.push("/news"))})}else o.b.success("News saved"),this.setState({edited:!1,isSaving:!1}),this.props.history.push("/news")})}else o.b.warning("Some field is required, please check your data."),this.setState({isSaving:!1})},this.handleContent=e=>{this.setState({content:e,edited:!0})},this.handleChange=e=>{this.setState({edited:!0});let{name:t,value:n}=e.target;if("image"===t){if(e.target.files.length)if(e.target.files[0].size<=5e6){let t={image:e.target.files[0],imagePreview:URL.createObjectURL(e.target.files[0])};this.setState(t)}else e.target.value=null,o.b.warning("Image size cannot larger than 5MB and must be an image file")}else this.setState({[t]:n})},this.state={edited:!1,id:this.props.match.params.id?this.props.match.params.id:"",companyId:"",image:"",imagePreview:"assets/images/no-image.png",isSaving:!1,userId:"",content:"Loading...",title:"",modalDelete:!1,disabledForm:this.props.disabledForm&&this.props.id},this.goBack=this.goBack.bind(this)}goBack(){this.props.goBack?this.props.goBack():this.props.history.push("/news")}getData(e){s.l.get("".concat(s.a,"v2/news/read/").concat(e)).then(e=>{e.data.error?o.b.error("Error read news"):this.setState({id:e.data.result.id,content:e.data.result.content,title:e.data.result.title,imagePreview:e.data.result.image?e.data.result.image:this.state.imagePreview})})}getUserData(){s.l.get("".concat(s.j).concat(r.a.get("user").data.email)).then(e=>{200===e.status&&this.setState({companyId:localStorage.getItem("companyID")?localStorage.getItem("companyID"):e.data.result.company_id,userId:e.data.result.user_id})})}componentDidMount(){this.getUserData(),this.props.disabledForm&&this.props.id?this.getData(this.props.id):this.props.match.params.id?this.getData(this.props.match.params.id):this.setState({content:""})}clearSessionForm(){this.setState({edited:!1,content:""})}render(){let{session:e,media:t}=this.state;return a.a.createElement("div",{className:"pcoded-main-container"},a.a.createElement("div",{className:"pcoded-wrapper"},a.a.createElement("div",{className:"pcoded-content"},a.a.createElement("div",{className:"pcoded-inner-content"},a.a.createElement("div",{className:"main-body"},a.a.createElement("div",{className:"page-wrapper"},a.a.createElement("div",{className:"floating-back"},a.a.createElement("img",{src:"newasset/back-button.svg",alt:"",width:90,onClick:this.goBack})),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-xl-12"},a.a.createElement("div",null,a.a.createElement("div",{className:"card p-20"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-sm-10 m-b-20"},a.a.createElement("strong",{className:"f-w-bold f-18",style:{color:"#000"}},this.props.id?"Detail":this.props.match.params.id?"Edit":"Create"," News")),a.a.createElement("div",{className:"col-sm-2 m-b-20"},this.props.disabledForm&&a.a.createElement("button",{onClick:this.props.goEdit,className:"btn btn-icademy-primary float-right",style:{padding:"7px 8px !important",marginRight:30}},a.a.createElement("i",{className:"fa fa-edit"}),"Edit"))),a.a.createElement("div",{className:"form-section no-border"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"col-sm-12 m-b-20"},a.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"News / Announcements"))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"form-field-top-label"},a.a.createElement("label",{for:"image"},"Thumbnail"),a.a.createElement("label",{for:"image",style:{cursor:"pointer",borderRadius:"10px",overflow:"hidden"}},a.a.createElement("img",{src:this.state.imagePreview,height:"54.8px"})),a.a.createElement("input",{type:"file",accept:"image/*",name:"image",id:"image",onChange:this.handleChange,disabled:this.state.disabledForm})),a.a.createElement("div",{className:"form-field-top-label"},a.a.createElement("label",{for:"title"},"Title",a.a.createElement("required",null,"*")),a.a.createElement("input",{type:"text",name:"title",size:"50",id:"name",placeholder:"XXXXX XXXXX XXXXX",value:this.state.title,onChange:this.handleChange,disabled:this.state.disabledForm})),a.a.createElement("div",{className:"form-field-top-label",style:{width:"80%"}},a.a.createElement("label",{for:"content"},"Content",a.a.createElement("required",null,"*")),a.a.createElement("input",{id:"myFile",type:"file",name:"myFile",style:{display:"none"},onChange:""}),"Loading..."!==this.state.content?a.a.createElement(c.a,{name:"content",apiKey:"j18ccoizrbdzpcunfqk7dugx72d7u9kfwls7xlpxg7m21mb5",initialValue:this.state.content,value:this.state.content,init:{height:400,convert_urls:!1,image_class_list:[{title:"None",value:""},{title:"Responsive",value:"img-responsive"},{title:"Thumbnail",value:"img-responsive img-thumbnail"}],file_browser_callback_types:"image",file_picker_callback:function(e,t,n){if("image"==n.filetype){var i=document.getElementById("myFile");i.click(),i.onchange=function(){var t=new FormData;t.append("file",this.files[0]),window.$.ajax({url:"".concat(s.a,"v2/media/upload"),type:"POST",data:t,processData:!1,contentType:!1,success:t=>{e(t.result.url),this.value=""}})}}},plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount","autoresize"],toolbar:"undo redo | bold italic backcolor |                                                                             alignleft aligncenter alignright alignjustify | image |                                                                                 bullist numlist outdent indent | removeformat | help"},onEditorChange:e=>this.handleContent(e)}):null))),a.a.createElement("div",{className:"row",style:{justifyContent:"flex-end"}},!this.props.disabledForm&&a.a.createElement("button",{disabled:this.state.isSaving,onClick:this.save,className:"btn btn-icademy-primary float-right",style:{padding:"7px 8px !important",marginRight:30}},a.a.createElement("i",{className:"fa fa-save"}),this.state.isSaving?"Saving...":"Save"))))))))))))}}t.default=l},305:function(e,t,n){"use strict";var i=n(0),a=n(9),o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},s={onActivate:a.func,onAddUndo:a.func,onBeforeAddUndo:a.func,onBeforeExecCommand:a.func,onBeforeGetContent:a.func,onBeforeRenderUI:a.func,onBeforeSetContent:a.func,onBeforePaste:a.func,onBlur:a.func,onChange:a.func,onClearUndos:a.func,onClick:a.func,onContextMenu:a.func,onCopy:a.func,onCut:a.func,onDblclick:a.func,onDeactivate:a.func,onDirty:a.func,onDrag:a.func,onDragDrop:a.func,onDragEnd:a.func,onDragGesture:a.func,onDragOver:a.func,onDrop:a.func,onExecCommand:a.func,onFocus:a.func,onFocusIn:a.func,onFocusOut:a.func,onGetContent:a.func,onHide:a.func,onInit:a.func,onKeyDown:a.func,onKeyPress:a.func,onKeyUp:a.func,onLoadContent:a.func,onMouseDown:a.func,onMouseEnter:a.func,onMouseLeave:a.func,onMouseMove:a.func,onMouseOut:a.func,onMouseOver:a.func,onMouseUp:a.func,onNodeChange:a.func,onObjectResizeStart:a.func,onObjectResized:a.func,onObjectSelected:a.func,onPaste:a.func,onPostProcess:a.func,onPostRender:a.func,onPreProcess:a.func,onProgressState:a.func,onRedo:a.func,onRemove:a.func,onReset:a.func,onSaveContent:a.func,onSelectionChange:a.func,onSetAttrib:a.func,onSetContent:a.func,onShow:a.func,onSubmit:a.func,onUndo:a.func,onVisualAid:a.func},r=o({apiKey:a.string,id:a.string,inline:a.bool,init:a.object,initialValue:a.string,onEditorChange:a.func,outputFormat:a.oneOf(["html","text"]),value:a.string,tagName:a.string,cloudChannel:a.string,plugins:a.oneOfType([a.string,a.array]),toolbar:a.oneOfType([a.string,a.array]),disabled:a.bool,textareaName:a.string,tinymceScriptSrc:a.string,scriptLoading:a.shape({async:a.bool,defer:a.bool,delay:a.number})},s),c=function(e){return"function"===typeof e},l=function(e){return e in s},d=function(e){return e.substr(2)},u=function(e,t,n,i,a){return function(e,t,n,i,a,o,s){var r=Object.keys(a).filter(l),c=Object.keys(o).filter(l),u=r.filter((function(e){return void 0===o[e]})),p=c.filter((function(e){return void 0===a[e]}));u.forEach((function(e){var t=d(e),i=s[t];n(t,i),delete s[t]})),p.forEach((function(n){var a=i(e,n),o=d(n);s[o]=a,t(o,a)}))}(a,e.on.bind(e),e.off.bind(e),(function(t,n){return function(i){var a;return null===(a=t(n))||void 0===a?void 0:a(i,e)}}),t,n,i)},p=0,h=function(e){var t=Date.now();return e+"_"+Math.floor(1e9*Math.random())+ ++p+String(t)},f=function(e){return null!==e&&("textarea"===e.tagName.toLowerCase()||"input"===e.tagName.toLowerCase())},m=function(e){return"undefined"===typeof e||""===e?[]:Array.isArray(e)?e:e.split(" ")},g=function(){return{listeners:[],scriptId:h("tiny-script"),scriptLoading:!1,scriptLoaded:!1}},v=function(){var e=g();return{load:function(t,n,i,a,o,s){var r=function(){return function(e,t,n,i,a,o){var s=t.createElement("script");s.referrerPolicy="origin",s.type="application/javascript",s.id=e,s.src=n,s.async=i,s.defer=a;var r=function(){s.removeEventListener("load",r),o()};s.addEventListener("load",r),t.head&&t.head.appendChild(s)}(e.scriptId,t,n,i,a,(function(){e.listeners.forEach((function(e){return e()})),e.scriptLoaded=!0}))};e.scriptLoaded?s():(e.listeners.push(s),e.scriptLoading||(e.scriptLoading=!0,o>0?setTimeout(r,o):r()))},reinitialize:function(){e=g()}}}(),y=n(424),b=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),w=function(){return(w=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},E=function(e){function t(t){var n,a,o,s=e.call(this,t)||this;return s.handleEditorChange=function(e){var t,n=s.editor;if(n&&n.initialized){var i=n.getContent({format:s.props.outputFormat});i!==s.currentContent&&(s.currentContent=i,c(s.props.onEditorChange)&&s.props.onEditorChange(null!==(t=s.currentContent)&&void 0!==t?t:"",n))}},s.initialise=function(){var e=s.elementRef.current;if(e){var t=Object(y.a)();if(!t)throw new Error("tinymce should have been loaded into global scope");var n,i,a=w(w({},s.props.init),{selector:void 0,target:e,readonly:s.props.disabled,inline:s.inline,plugins:(n=s.props.init&&s.props.init.plugins,i=s.props.plugins,m(n).concat(m(i))),toolbar:s.props.toolbar||s.props.init&&s.props.init.toolbar,setup:function(t){s.editor=t,s.bindHandlers({}),s.inline&&!f(e)&&t.once("PostRender",(function(e){t.setContent(s.getInitialValue(),{no_events:!0})})),s.props.init&&c(s.props.init.setup)&&s.props.init.setup(t)}});s.inline||(e.style.visibility=""),f(e)&&(e.value=s.getInitialValue()),t.init(a)}},s.id=s.props.id||h("tiny-react"),s.elementRef=i.createRef(),s.inline=null!==(o=null!==(n=s.props.inline)&&void 0!==n?n:null===(a=s.props.init)||void 0===a?void 0:a.inline)&&void 0!==o&&o,s.boundHandlers={},s}return b(t,e),t.prototype.componentDidUpdate=function(e){var t,n=this;if(this.editor&&this.editor.initialized){if(this.bindHandlers(e),this.currentContent=null!==(t=this.currentContent)&&void 0!==t?t:this.editor.getContent({format:this.props.outputFormat}),"string"===typeof this.props.value&&this.props.value!==e.value&&this.props.value!==this.currentContent){var i=this.editor;i.undoManager.transact((function(){return i.setContent(n.props.value)}))}"boolean"===typeof this.props.disabled&&this.props.disabled!==e.disabled&&this.editor.setMode(this.props.disabled?"readonly":"design")}},t.prototype.componentDidMount=function(){var e,t,n,i,a,o;null!==Object(y.a)()?this.initialise():this.elementRef.current&&this.elementRef.current.ownerDocument&&v.load(this.elementRef.current.ownerDocument,this.getScriptSrc(),null!==(t=null===(e=this.props.scriptLoading)||void 0===e?void 0:e.async)&&void 0!==t&&t,null!==(i=null===(n=this.props.scriptLoading)||void 0===n?void 0:n.defer)&&void 0!==i&&i,null!==(o=null===(a=this.props.scriptLoading)||void 0===a?void 0:a.delay)&&void 0!==o?o:0,this.initialise)},t.prototype.componentWillUnmount=function(){var e=this,t=this.editor;t&&(t.off("change keyup setcontent",this.handleEditorChange),Object.keys(this.boundHandlers).forEach((function(n){t.off(n,e.boundHandlers[n])})),this.boundHandlers={},t.remove(),this.editor=void 0)},t.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},t.prototype.renderInline=function(){var e=this.props.tagName,t=void 0===e?"div":e;return i.createElement(t,{ref:this.elementRef,id:this.id})},t.prototype.renderIframe=function(){return i.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id})},t.prototype.getScriptSrc=function(){if("string"===typeof this.props.tinymceScriptSrc)return this.props.tinymceScriptSrc;var e=this.props.cloudChannel;return"https://cdn.tiny.cloud/1/"+(this.props.apiKey?this.props.apiKey:"no-api-key")+"/tinymce/"+e+"/tinymce.min.js"},t.prototype.getInitialValue=function(){return"string"===typeof this.props.value?this.props.value:"string"===typeof this.props.initialValue?this.props.initialValue:""},t.prototype.bindHandlers=function(e){var t=this;if(void 0!==this.editor){u(this.editor,e,this.props,this.boundHandlers,(function(e){return t.props[e]}));var n=function(e){return void 0!==e.onEditorChange||void 0!==e.value},i=n(e),a=n(this.props);!i&&a?this.editor.on("change keyup setcontent",this.handleEditorChange):i&&!a&&this.editor.off("change keyup setcontent",this.handleEditorChange)}},t.propTypes=r,t.defaultProps={cloudChannel:"5"},t}(i.Component);n.d(t,"a",(function(){return E}))},424:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var i=function(){return"undefined"!==typeof window?window:e},a=function(){var e=i();return e&&e.tinymce?e.tinymce:null}}).call(this,n(28))}}]);
//# sourceMappingURL=79.cd9e2570.chunk.js.map