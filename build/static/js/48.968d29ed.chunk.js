(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[48],{930:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),n=a(18),l=a(433),r=a(19),d=a.n(r),o=a(1613),c=a(2),m=a(3);class h extends s.Component{constructor(e){super(e),this.changePassword=e=>{if(this.setState({isSaving:!0}),this.state.newPassword){let e={training_user_id:this.props.id,password:this.state.newPassword};m.l.put("".concat(m.a,"v2/training/user-password"),e).then(e=>{e.data.error?(n.b.error("Error change password"),this.setState({isSaving:!1})):(n.b.success("Success change user's password"),this.setState({isSaving:!1}),this.closeModalPassword())})}else n.b.warning("Insert the new password")},this.validateEmail=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),this.save=e=>{if(this.setState({isSaving:!0}),e.preventDefault(),this.validateEmail(this.state.email)&&(this.props.match.params.id||this.state.expired||!this.state.license_number)&&this.state.name&&this.state.born_date&&this.state.gender&&this.state.address&&this.state.city&&this.state.phone&&this.state.email&&this.state.training_company_id)if(this.props.match.params.id){let e={image:this.state.image,training_company_id:this.state.training_company_id,name:this.state.name,born_place:this.state.born_place,born_date:this.state.born_date,gender:this.state.gender,identity:this.state.identity,tin:this.state.tin,license_number:this.state.license_number,address:this.state.address,city:this.state.city,phone:this.state.phone,email:this.state.email,created_by:c.a.get("user").data.user_id,tag:this.state.tag};m.l.put("".concat(m.a,"v2/training/user/").concat(this.props.match.params.id),e).then(e=>{if(e.data.error)n.b.error("Error edit ".concat(this.state.level," : ").concat(e.data.result));else if(this.state.image){this.setState({isSaving:!0});let e=new FormData;e.append("image",this.state.image),m.l.put("".concat(m.a,"v2/training/user/image/").concat(this.props.match.params.id),e).then(e=>{if(e.data.error)n.b.warning("".concat(this.state.level," edited but fail to upload image"));else if(this.state.imageIdentity){this.setState({isSaving:!0});let e=new FormData;e.append("image",this.state.imageIdentity),m.l.put("".concat(m.a,"v2/training/user/image-identity/").concat(this.props.match.params.id),e).then(e=>{e.data.error?n.b.warning("".concat(this.state.level," edited but fail to upload identity image")):(n.b.success("".concat(this.state.level," edited")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(this.props.match.params.id)))})}else n.b.success("".concat(this.state.level," edited")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(this.props.match.params.id))})}else if(this.state.imageIdentity){this.setState({isSaving:!0});let e=new FormData;e.append("image",this.state.imageIdentity),m.l.put("".concat(m.a,"v2/training/user/image-identity/").concat(this.props.match.params.id),e).then(e=>{e.data.error?n.b.warning("".concat(this.state.level," edited but fail to upload identity image")):(n.b.success("".concat(this.state.level," edited")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(this.props.match.params.id)))})}else n.b.success("".concat(this.state.level," edited")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(this.props.match.params.id))})}else{let e={training_company_id:this.state.training_company_id,image:this.state.image,name:this.state.name,born_place:this.state.born_place,born_date:this.state.born_date,gender:this.state.gender,identity:this.state.identity,tin:this.state.tin,license_number:this.state.license_number,expired:this.state.expired,address:this.state.address,city:this.state.city,phone:this.state.phone,email:this.state.email,level:this.props.match.params.level,created_by:c.a.get("user").data.user_id};m.l.post("".concat(m.a,"v2/training/user"),e).then(e=>{if(e.data.error)n.b.error("Error create ".concat(this.state.level," : ").concat(e.data.result)),this.setState({isSaving:!1});else if(this.state.image){this.setState({isSaving:!0});let t=new FormData;t.append("image",this.state.image),m.l.put("".concat(m.a,"v2/training/user/image/").concat(e.data.result.insertId),t).then(t=>{if(t.data.error)n.b.warning("".concat(this.state.level," created but fail to upload image")),this.goBack(),this.setState({isSaving:!1});else if(this.state.imageIdentity){this.setState({isSaving:!0});let t=new FormData;t.append("image",this.state.imageIdentity),m.l.put("".concat(m.a,"v2/training/user/image-identity/").concat(e.data.result.insertId),t).then(t=>{t.data.error?n.b.warning("".concat(this.state.level," created but fail to upload identity image")):(n.b.success("".concat(this.state.level," created")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(e.data.result.insertId)))})}else n.b.success("".concat(this.state.level," created")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(e.data.result.insertId))})}else if(this.state.imageIdentity){this.setState({isSaving:!0});let t=new FormData;t.append("image",this.state.imageIdentity),m.l.put("".concat(m.a,"v2/training/user/image-identity/").concat(e.data.result.insertId),t).then(t=>{t.data.error?n.b.warning("".concat(this.state.level," edited but fail to upload identity image")):(n.b.success("".concat(this.state.level," created")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(e.data.result.insertId)))})}else n.b.success("".concat(this.state.level," created")),this.setState({isSaving:!1}),this.props.history.push("/training/user/detail/".concat(e.data.result.insertId))})}else n.b.warning("Some field is required or not in their format, please check your data."),this.setState({isSaving:!1})},this.handleChange=e=>{let{name:t,value:a}=e.target;"image"===t?e.target.files.length&&(e.target.files[0].size<=5e6?this.setState({image:e.target.files[0],imagePreview:URL.createObjectURL(e.target.files[0])}):(e.target.value=null,n.b.warning("Image size cannot larger than 5MB"))):"imageIdentity"===t?e.target.files.length&&(e.target.files[0].size<=5e6?this.setState({imageIdentity:e.target.files[0],imageIdentityPreview:URL.createObjectURL(e.target.files[0])}):(e.target.value=null,n.b.warning("Identity Image size cannot larger than 5MB"))):this.setState({[t]:a})},this.closeModalPassword=e=>{this.setState({modalPassword:!1,newPassword:""})},this.fetchProvince=async()=>{try{const e=(await m.l.get("".concat(m.a,"v2/training/provinces"))).data.result.map(e=>({value:e.prov_id,label:e.prov_name}));this.setState({province:e})}catch(e){console.log(e)}},this.fetchCities=async e=>{try{const t=(await m.l.get("".concat(m.a,"v2/training/cities/").concat(e))).data.result.map(e=>({value:e.city_id,label:e.city_name}));this.setState({cities:t})}catch(t){console.log(t)}},this.handleChangeProvince=e=>{this.setState({selectedProvince:e,selectedCity:null,cities:null})},this.handleChangeCity=e=>{this.setState({selectedCity:e,city:e?e.label:null})},this.state={province:null,selectedProvince:null,cities:null,selectedCity:null,image:"",imagePreview:"assets/images/no-profile-picture.jpg",imageIdentity:"",imageIdentityPreview:"assets/images/no-image.png",training_company_id:"",name:"",born_place:"",born_date:"",gender:"",identity:"",tin:"",address:"",city:"",phone:"",email:"",level:"",license_number:"",expired:"",optionCompany:[],companyId:"",modalPassword:!1,newPassword:"",history:[],disabledForm:this.props.disabledForm&&this.props.id,isSaving:!1},this.goBack=this.goBack.bind(this)}goBack(){this.props.goBack?this.props.goBack():this.props.history.goBack()}getUser(e){m.l.get("".concat(m.a,"v2/training/user/read/").concat(e)).then(e=>{e.data.error?n.b.error("Error read user"):this.setState({selectedProvince:{value:e.data.result.prov_id,label:e.data.result.prov_name},selectedCity:{value:e.data.result.city_id,label:e.data.result.city_name},training_company_id:e.data.result.training_company_id,name:e.data.result.name,born_place:e.data.result.born_place,born_date:e.data.result.born_date,gender:e.data.result.gender,identity:e.data.result.identity,tin:e.data.result.tin,license_number:e.data.result.license_number,address:e.data.result.address,city:e.data.result.city,phone:e.data.result.phone,email:e.data.result.email,imagePreview:e.data.result.image?e.data.result.image:this.state.imagePreview,imageIdentityPreview:e.data.result.identity_image?e.data.result.identity_image:this.state.imageIdentityPreview})}),this.getHistory(e)}getHistory(e){m.l.get("".concat(m.a,"v2/training/user-history/").concat(e)).then(e=>{e.data.error?n.b.error("Error read history"):this.setState({history:e.data.result})})}getUserData(){m.l.get("".concat(m.j).concat(c.a.get("user").data.email)).then(e=>{200===e.status&&(this.setState({companyId:localStorage.getItem("companyID")?localStorage.getItem("companyID"):e.data.result.company_id}),this.getCompany(this.state.companyId))})}getCompany(e){m.l.get("".concat(m.a,"v2/training/company/").concat(e)).then(e=>{e.data.error?n.b.error("Error read company"):this.setState({optionCompany:e.data.result})})}componentDidUpdate(e,t){t.selectedProvince!==this.state.selectedProvince&&this.state.selectedProvince&&this.fetchCities(this.state.selectedProvince.value)}componentDidMount(){this.fetchProvince(),this.getUserData(),this.props.disabledForm&&this.props.id?this.getUser(this.props.id):this.props.match.params.id&&this.getUser(this.props.match.params.id),this.setState({level:this.props.match.params.level?this.props.match.params.level:"user",training_company_id:"0"!==this.props.match.params.company?this.props.match.params.company:""})}render(){return i.a.createElement("div",{className:"pcoded-main-container"},i.a.createElement("div",{className:"pcoded-wrapper"},i.a.createElement("div",{className:"pcoded-content"},i.a.createElement("div",{className:"pcoded-inner-content"},i.a.createElement("div",{className:"main-body"},i.a.createElement("div",{className:"page-wrapper"},i.a.createElement("div",{className:"floating-back"},i.a.createElement("img",{src:"newasset/back-button.svg",alt:"",width:90,onClick:this.goBack})),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-xl-12"},i.a.createElement("div",null,i.a.createElement("div",{className:"card p-20"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-10 m-b-20"},i.a.createElement("strong",{className:"f-w-bold f-18",style:{color:"#000"}},this.props.id?"Detail":this.props.match.params.id?"Edit":"Create New"," ","admin"===this.state.level?"Admin":"User")),i.a.createElement("div",{className:"col-sm-2 m-b-20"},this.props.disabledForm&&i.a.createElement("button",{onClick:this.props.goEdit,className:"btn btn-icademy-primary float-right",style:{padding:"7px 8px !important",marginRight:30}},i.a.createElement("i",{className:"fa fa-edit"}),"Edit"),this.props.disabledForm&&i.a.createElement("button",{onClick:()=>this.setState({modalPassword:!0}),className:"btn btn-icademy-primary float-right",style:{padding:"7px 8px !important",marginRight:30}},i.a.createElement("i",{className:"fa fa-key"}),"Change Password"))),"client"===c.a.get("user").data.level?null:i.a.createElement("div",{className:"form-section"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12 m-b-20"},i.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"Company"))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"training_company_id"},"Company Name",i.a.createElement("required",null,"*")),i.a.createElement("select",{name:"training_company_id",value:this.state.training_company_id,id:"training_company_id",onChange:this.handleChange,disabled:this.state.disabledForm},i.a.createElement("option",{value:""},"Select Company"),this.state.optionCompany.map(e=>i.a.createElement("option",{value:e.id,selected:this.state.training_company_id===e.id},e.name)))))),i.a.createElement("div",{className:"form-section"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12 m-b-20"},i.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"Personal Information"))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"image"},"Profile Picture"),i.a.createElement("center",null,i.a.createElement("label",{style:{cursor:"pointer",borderRadius:"4px",overflow:"hidden"}},i.a.createElement("a",{href:this.state.imagePreview,target:"_blank"},i.a.createElement("img",{src:this.state.imagePreview,style:{objectFit:"cover",width:"54.8px",height:"54.8px"}}))),i.a.createElement("label",{for:"image",style:{cursor:"pointer",overflow:"hidden",display:this.state.disabledForm?"none":"block"}},i.a.createElement("div",{className:"button-bordered-grey"},this.state.image?this.state.image.name:"Choose file"))),i.a.createElement("input",{type:"file",accept:"image/*",name:"image",id:"image",onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"name"},"Name",i.a.createElement("required",null,"*")),i.a.createElement("input",{type:"text",name:"name",id:"name",placeholder:!this.state.disabledForm&&"Input Name",value:this.state.name,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"born_place"},"Born Place"),i.a.createElement("input",{type:"text",name:"born_place",id:"born_place",placeholder:!this.state.disabledForm&&"Input Born Place",value:this.state.born_place,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"born_date"},"Born Date",i.a.createElement("required",null,"*")),i.a.createElement("input",{type:"date",name:"born_date",id:"born_date",value:this.state.born_date,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"gender"},"Gender",i.a.createElement("required",null,"*")),i.a.createElement("select",{name:"gender",id:"gender",onChange:this.handleChange,disabled:this.state.disabledForm},i.a.createElement("option",{value:""},"Select Gender"),i.a.createElement("option",{value:"Male",selected:"Male"===this.state.gender},"Male"),i.a.createElement("option",{value:"Female",selected:"Female"===this.state.gender},"Female"))))),i.a.createElement("div",{className:"form-section"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12 m-b-20"},i.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"Identification"))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"imageIdentity"},"Identity Card Photo",i.a.createElement("required",null,"*")),i.a.createElement("center",null,i.a.createElement("label",{style:{cursor:"pointer",borderRadius:"4px",overflow:"hidden"}},i.a.createElement("a",{href:this.state.imageIdentityPreview,target:"_blank"},i.a.createElement("img",{src:this.state.imageIdentityPreview,style:{objectFit:"cover",width:"54.8px",height:"54.8px"}}))),i.a.createElement("label",{for:"imageIdentity",style:{cursor:"pointer",overflow:"hidden",display:this.state.disabledForm?"none":"block"}},i.a.createElement("div",{className:"button-bordered-grey"},this.state.imageIdentity?this.state.imageIdentity.name:"Choose file"))),i.a.createElement("input",{type:"file",accept:"image/*",name:"imageIdentity",id:"imageIdentity",onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"identity"},"Identity Card Number",i.a.createElement("required",null,"*")),i.a.createElement("input",{type:"text",name:"identity",id:"identity",placeholder:!this.state.disabledForm&&"Input Identity Card Number",maxlength:"16",value:this.state.identity,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"tin"},"Tax Identification Number"),i.a.createElement("input",{type:"text",name:"tin",id:"tin",placeholder:!this.state.disabledForm&&"Input Tax Identification Number",value:this.state.tin,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"license_number"},"License Number"),i.a.createElement("input",{type:"text",size:"30",name:"license_number",id:"license_number",placeholder:this.state.disabledForm||this.props.match.params.id?"":"Input License Number",value:this.state.license_number,onChange:this.handleChange,disabled:this.state.disabledForm})),this.state.license_number?!this.state.license_number.length||this.props.match.params.id||this.state.disabledForm?null:i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"expired"},"License Expired",i.a.createElement("required",{style:{fontSize:"11px"}},"*Required if License Number filled")),i.a.createElement("input",{type:"date",name:"expired",id:"expired",value:this.state.expired,onChange:this.handleChange,disabled:this.state.disabledForm})):null)),i.a.createElement("div",{className:"form-section"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12 m-b-20"},i.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"Address"))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"address"},"Address",i.a.createElement("required",null,"*")),i.a.createElement("textarea",{name:"address",rows:"3",cols:"60",id:"address",placeholder:!this.state.disabledForm&&"Input Address",value:this.state.address,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label",style:{display:"flex",flexDirection:"column",width:"250px"}},i.a.createElement("label",{for:"province"},"Province",i.a.createElement("required",null,"*")),i.a.createElement(l.a,{placeholder:"Select Province",isClearable:!0,value:this.state.selectedProvince,onChange:this.handleChangeProvince,options:this.state.province,isDisabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label",style:{display:"flex",flexDirection:"column",width:"250px"}},i.a.createElement("label",{for:"city"},"City",i.a.createElement("required",null,"*")),i.a.createElement(l.a,{placeholder:"Select City",isClearable:!0,value:this.state.selectedCity,onChange:this.handleChangeCity,options:null!==this.state.cities?this.state.cities:[],isDisabled:this.state.disabledForm})))),i.a.createElement("div",{className:"form-section ".concat(!this.props.disabledForm&&this.state.history.length?"no-border":"")},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12 m-b-20"},i.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"Contact"))),i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"phone"},"Phone Number",i.a.createElement("required",null,"*")),i.a.createElement("input",{type:"number",name:"phone",id:"phone",placeholder:!this.state.disabledForm&&"Input Phone Number",value:this.state.phone,onChange:this.handleChange,disabled:this.state.disabledForm})),i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"email"},"Email",i.a.createElement("required",null,"*")),i.a.createElement("input",{type:"text",size:"50",name:"email",id:"email",placeholder:!this.state.disabledForm&&"Input Email",value:this.state.email,onChange:this.handleChange,disabled:this.state.disabledForm})))),this.state.history.length&&this.props.disabledForm?i.a.createElement("div",{className:"form-section no-border"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm-12 m-b-20"},i.a.createElement("strong",{className:"f-w-bold",style:{color:"#000",fontSize:"15px"}},"Company History"))),i.a.createElement("div",{className:"row"},i.a.createElement("table",{className:"table-log"},i.a.createElement("tr",null,i.a.createElement("th",null,"Time"),i.a.createElement("th",null,"Source Company"),i.a.createElement("th",null,"Destination Company"),i.a.createElement("th",null,"By")),this.state.history.map(e=>i.a.createElement("tr",null,i.a.createElement("td",null,d()(e.created_at).local().format("DD-MM-YYYY HH:mm")),i.a.createElement("td",null,e.source),i.a.createElement("td",null,e.destination),i.a.createElement("td",null,e.creator)))))):null,i.a.createElement("div",{className:"row",style:{justifyContent:"flex-end"}},!this.props.disabledForm&&i.a.createElement("button",{onClick:this.save,disabled:this.state.isSaving,className:"btn btn-icademy-primary float-right",style:{padding:"7px 8px !important",marginRight:30}},i.a.createElement("i",{className:"fa fa-save"}),this.state.isSaving?"Saving...":"Save"))))))))))),i.a.createElement(o.a,{show:this.state.modalPassword,onHide:this.closeModalPassword},i.a.createElement(o.a.Header,{closeButton:!0},i.a.createElement(o.a.Title,{className:"text-c-purple3 f-w-bold",style:{color:"#00478C"}},"Change Password")),i.a.createElement(o.a.Body,null,i.a.createElement("div",{className:"form-field-top-label"},i.a.createElement("label",{for:"name"},"New Password",i.a.createElement("required",null,"*")),i.a.createElement("input",{type:"password",name:"newPassword",id:"newPassword",value:this.state.newPassword,onChange:this.handleChange}))),i.a.createElement(o.a.Footer,null,i.a.createElement("button",{className:"btn btm-icademy-primary btn-icademy-grey",onClick:this.closeModalPassword},"Cancel"),i.a.createElement("button",{className:"btn btn-icademy-primary",onClick:this.changePassword.bind(this),disabled:this.state.isSaving},i.a.createElement("i",{className:"fa fa-save"})," ",this.state.isSaving?"Saving...":"Save"))))}}t.default=h}}]);
//# sourceMappingURL=48.968d29ed.chunk.js.map